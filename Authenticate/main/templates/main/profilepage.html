{% extends "main/base.html" %}
{% load static %}
{% block title %}{{ user.username }}'s Profile{% endblock title %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">

<div class="profile">
    <!-- Cover Photo -->
    <div class="cover-pics">
        {% if user.profile.cover_photo %}
            <img src="{{ user.profile.cover_photo.url }}" alt="{{ user.username }}'s cover photo">
        {% else %}
            <img src="{% static 'default_cover.jpg' %}" alt="Default Cover Photo">
        {% endif %}
    </div>

    <div class="profile-dp-pane">

        <!-- aside nav -->
        <div>
            <aside>
                <!-- Profile and Menu Section -->
                <img class="dp" src="{% if user.profile.image %}{{ user.profile.image.url }}{% else %}{% static 'images/user-solid.svg' %}{% endif %}" alt="{{ user.username }}'s profile picture"> 
                <p id="username">@{{user.username}} </a>

                <ul>
                    <li><a href="{% url 'profile' user.username %}">{{user.username}}'s Profile</a></li>
                    <li><a href="/feed">Home</a></li>
                    <li><a href="#">New Squad</a></li>
                    <li><a href="#">Explore</a></li>
                    <li><a href="#">Discussions</a></li>
                    <hr id="hr">
                    <label class="tabs">
                    <li><a class="tab" id="followers-tab">Followers</a></li>
                    <li><a class="tab active" id="posts-tab">Posts</a></li>
                    <li><a class="tab" id="following-tab">Following</a></li>

                      <!-- Following Section -->
                    <div class="following-list" id="following-content" style="display: none;">
                        {% for following in user.profile.following.all %}
                        <div class="following-item">
                            <div>
                                <img src="{{ following.profile.image.url }}" alt="{{ following.username }}'s profile picture">
                            </div>
                            <div>
                                <a href="{% url 'profile' following.username %}">{{following.username}}</a>
                            </div>
                        </div>
                        {% empty %}
                        <p>0 following.</p>
                        {% endfor %}
                    </div>
                    </label>

                    <!-- Followers Section -->
                        <div class="followers-list" id="followers-content" style="display: block;">
                            {% for follower in user.profile.followers.all %}
                            <div class="follower-item">
                                <div>
                                    <img src="{{ follower.profile.image.url }}" alt="{{ follower.username }}'s profile picture">
                                </div>
                                <div>
                                    <a href="{% url 'profile' follower.username %}">{{follower.username}}</a>
                                </div>
                            </div>

                            {% empty %}
                                <p>0 followers</p>
                            {% endfor %}

                        </div>
                        <hr>

                    <li><a href="#">Docs</a></li>
                    <li><a href="#">Changelog</a></li>
                    <li><a href="#">Get Started</a></li>
                    <a id="get-started-link" href="/logout">Logout</a>
                </ul>
            </aside>
        </div>
        
        <!-- Profile Picture -->
        <div class="profile-picture">
            <div>
                {% if user.profile.image %}
                    <img src="{{ user.profile.image.url }}" alt="{{ user.username }}'s profile picture">
                {% else %}
                    <img src="{% static 'default.jpg' %}" alt="Default Profile Picture">
                {% endif %}
            </div>
            
            <!-- User Information -->
            <div>
                <h1 class="username">{{ user.username }}</h1>
                <p class="bio">{{ user.profile.bio|default:"This user hasn't updated their bio yet." }}</p>
            </div>
        </div>

        <!-- Profile Edit (only visible for the logged-in user) -->
        <div>
            {% if request.user == user %}
            <a id="edit-profile" href="{% url 'edit_profile' user.username %}">Edit Profile</a>
            {% endif %}
        </div>


    </div>

    <div class="follower-counts">
            <!-- Followers and Following Counts -->
        
            <div>
                    <h1>{{ user.profile.followers.count}}</h1>
                    <p>Followers</p>
            </div>

            <div>
                <h1>{{ user.profile.following.count }}</h1>
                <p>Following</p>
            </div>

            <!-- Follow/Unfollow Button (only show for other users' profiles) -->
            <div>            
                {% if request.user != user %}
                <form method="POST" action="{% url 'follow_user' user.id %}">
                    {% csrf_token %}
                    {% if request.user in user.profile.followers.all %}
                        <button type="submit" class="follow-button">Unfollow</button>
                    {% else %}
                        <button type="submit" class="follow-button">Follow</button>
                    {% endif %}
                </form>
                {% endif %}
            </div> 
        
        </div>
    <hr>
</div>



    
   

    

   

  

<!-- Tabs for Posts, Followers, Following -->

<!-- Main Content Section -->
<section id="main-content">
    <!-- Display Projects (Posts) -->
    <div class="projects-grid" id="posts-content">
        {% for project in user.projects.all %}
        <div class="project">
            <img src="{{ project.image.url }}" alt="Project image">
            <div class="project-info">
                <h3>{{ project.title }}</h3>
                <p>{{ project.description }}</p>
            </div>
        </div>
        {% empty %}
        <p>No posts available.</p>
        {% endfor %}
    </div>


  
</section>

<!-- JavaScript to switch between tabs -->
<script>
document.getElementById('posts-tab').addEventListener('click', function() {
    document.getElementById('posts-content').style.display = 'block';
    document.getElementById('followers-content').style.display = 'none';
    document.getElementById('following-content').style.display = 'none';
});

document.getElementById('followers-tab').addEventListener('click', function() {
    document.getElementById('posts-content').style.display = 'none';
    document.getElementById('followers-content').style.display = 'block';
    document.getElementById('following-content').style.display = 'none';
});

document.getElementById('following-tab').addEventListener('click', function() {
    document.getElementById('posts-content').style.display = 'none';
    document.getElementById('followers-content').style.display = 'none';
    document.getElementById('following-content').style.display = 'block';
});
</script>

{% endblock content %}
